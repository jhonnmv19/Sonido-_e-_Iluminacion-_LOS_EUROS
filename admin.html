<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Administrador - Los Euros</title>
  <link rel="stylesheet" href="Estilos/Style.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <link rel="icon" href="Imagenes/logo Los euros_facturas.png" type="image/png">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fefae2;
      color: #620f14;
      margin: 0;
      padding: 0;
    }

    h1, h2 {
      text-align: center;
      color: #a4202e;
      margin-top: 20px;
    }

    h1 {
      font-size: 2.5rem;
    }

    h2 {
      font-size: 2rem;
      margin-top: 40px;
      padding: 10px;
      background-color: #e7b263;
      color: #fff;
      border-radius: 5px;
    }

    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      border: 1px solid #ddd;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border: 1px solid #ddd;
    }

    th {
      background-color: #e7b263;
      color: #fff;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    .boton-flotante {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #a4202e;
  color: #fefae2;
  padding: 12px 20px;
  border-radius: 50px;
  text-decoration: none;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: background-color 0.3s, transform 0.2s;
  z-index: 1000;
}

.boton-flotante:hover {
  background-color: #620f14;
  transform: scale(1.05);
}

    .cliente-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}
.cliente-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.card-cliente {
  display: flex;
  background-color: #f9f9f9;
  border-radius: 12px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  align-items: center;
}

.cliente-foto {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 15px;
  border: 2px solid #ccc;
}

.cliente-info {
  flex: 1;
}

.cliente-info h3 {
  margin: 0 0 8px 0;
  font-size: 18px;
  color: #222;
}

.cliente-info p {
  margin: 4px 0;
  font-size: 14px;
  color: #555;
}

.empleado-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .card-empleado {
      background-color: white;
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 280px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.3s ease;
    }

    .card-empleado:hover {
      transform: translateY(-5px);
    }

    .empleado-foto {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      border: 3px solid #e7b263;
    }

    .empleado-info h3 {
      margin: 10px 0 5px;
      color: #a4202e;
    }

    .empleado-info p {
      margin: 4px 0;
      font-size: 14px;
      color: #333;
    }
/* RESPONSIVE: 2 columnas para m√≥viles */
@media (max-width: 768px) {
  h1 {
    font-size: 2rem;
  }

  h2 {
    font-size: 1.5rem;
  }

  table {
    font-size: 13px;
  }

  th, td {
    padding: 6px;
  }

  .cliente-cards, .empleado-cards {
    grid-template-columns: repeat(2, 1fr); /* 2 columnas */
  }

  .card-cliente, .card-empleado {
    flex-direction: column;
    text-align: center;
  }

  .cliente-foto, .empleado-foto {
    margin: 0 auto;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.6rem;
  }

  h2 {
    font-size: 1.3rem;
  }

  table {
    font-size: 12px;
  }

  .cliente-cards, .empleado-cards {
    grid-template-columns: repeat(2, 1fr); /* Siempre 2 columnas */
  }

  .boton-flotante {
    font-size: 12px;
    padding: 8px 10px;
    bottom: 15px;
    right: 15px;
  }
}
  </style>
</head>
<!-- ... Tu encabezado HTML sigue igual ... -->



  <div class="container">
    <h1>Panel del Administrador - Los Euros</h1>

    <section>
      <h2>üìä Reporte de Ventas (Resumen)</h2>
      <table>
        <thead>
          <tr>
            <th>ID Cliente</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>ID Producto</th>
            <th>Nombre del Producto</th>
            <th>Cantidad</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
         
          <!-- M√°s ventas -->
        </tbody>
      </table>
    </section>

    <section>
      <h2>üî• Productos m√°s vendidos</h2>
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Precio Unitario</th>
            <th>Cantidad Vendida</th>
            <th>Total Generado</th>
          </tr>
        </thead>
        <tbody>
         
          
        </tbody>
      </table>
    </section>
    

    <section>
      <h2>üßë‚Äçüíº Empleados</h2>
      <div class="empleado-cards">
  
        <div class="card-empleado">
          <img src="Imagenes/Laura Mart√≠nez.jpeg" alt="Foto de Laura Mart√≠nez" class="empleado-foto" />
          <div class="empleado-info">
            <h3>Laura Mart√≠nez</h3>
            <p><strong>Cargo:</strong> Ventas</p>
            <p><strong>Edad:</strong> 32</p>
            <p><strong>Email:</strong> laura.martinez@email.com</p>
            <p><strong>Estado:</strong> Libre</p>
            <p><strong>Hora Entrada:</strong> 08:00</p>
            <p><strong>Hora Salida:</strong> 16:00</p>
          </div>
        </div>
  
        <div class="card-empleado">
          <img src="Imagenes/Diego Gonz√°lez.jpg" alt="Foto de Diego Gonz√°lez" class="empleado-foto" />
          <div class="empleado-info">
            <h3>Diego Gonz√°lez</h3>
            <p><strong>Cargo:</strong> Soporte T√©cnico</p>
            <p><strong>Edad:</strong> 29</p>
            <p><strong>Email:</strong> diego.gonzalez@email.com</p>
            <p><strong>Estado:</strong> Vacaciones</p>
            <p><strong>Hora Entrada:</strong> 08:00</p>
            <p><strong>Hora Salida:</strong> 17:30 </p>
          </div>
        </div>
  
        <div class="card-empleado">
          <img src="Imagenes/Ana Torres.jpg" alt="Foto de Ana Torres" class="empleado-foto" />
          <div class="empleado-info">
            <h3>Ana Torres</h3>
            <p><strong>Cargo:</strong> Instalaciones</p>
            <p><strong>Edad:</strong> 40</p>
            <p><strong>Email:</strong> ana.torres@email.com</p>
            <p><strong>Estado:</strong> Libre</p>
            <p><strong>Hora Entrada:</strong> 09:00</p>
            <p><strong>Hora Salida:</strong> 17:00</p>
          </div>
        </div>
  
        <div class="card-empleado">
          <img src="Imagenes/Jos√© Morales.jpeg" alt="Foto de Jos√© Morales" class="empleado-foto" />
          <div class="empleado-info">
            <h3>Jos√© Morales</h3>
            <p><strong>Cargo:</strong> Log√≠stica</p>
            <p><strong>Edad:</strong> 37</p>
            <p><strong>Email:</strong> jose.morales@email.com</p>
            <p><strong>Estado:</strong> Libre</p>
            <p><strong>Hora Entrada:</strong> 07:30</p>
            <p><strong>Hora Salida:</strong> 15:30</p>
          </div>
        </div>
  
      </div>
    </section>

  
    <section>
      <h2>üë§ Perfiles de Clientes</h2>
      <div class="cliente-cards">
        
    </section>

    <a href="index.html" class="boton-flotante">Volver al inicio</a>

  </div>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // 1Ô∏è‚É£ Conexi√≥n a Supabase
  const SUPABASE_URL = "https://ujvcuuodacbtlvdnwafj.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmN1dW9kYWNidGx2ZG53YWZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMTQ4MDYsImV4cCI6MjA3MzY5MDgwNn0.voYziriyh2ROHnekjhCnen0R6b3AGKdtNzqCa4llfBk"; // ‚ö†Ô∏è Reemplaza con tu ANON_KEY de Supabase
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  document.addEventListener("DOMContentLoaded", async () => {
    await cargarVentas();
    await cargarProductosMasVendidos();
    await cargarClientes();
  });

  // 2Ô∏è‚É£ Cargar Reporte de Ventas
  async function cargarVentas() {
    const tabla = document.querySelector("section:nth-of-type(1) table tbody");
    tabla.innerHTML = "<tr><td colspan='7'>Cargando datos...</td></tr>";

    const { data, error } = await supabase
      .from("detalle_pedido")
      .select(`
        id,
        producto,
        cantidad,
        precio,
        pedidos:pedido_id (
          id,
          nombre,
          apellido,
          direccion,
          telefono,
          correo,
          total
        )
      `)
      .order("id", { ascending: true });

    if (error) {
      console.error("Error al cargar ventas:", error);
      tabla.innerHTML = "<tr><td colspan='7'>Error al cargar datos.</td></tr>";
      return;
    }

    if (!data || data.length === 0) {
      tabla.innerHTML = "<tr><td colspan='7'>No hay ventas registradas.</td></tr>";
      return;
    }

    tabla.innerHTML = "";
    data.forEach(item => {
      const p = item.pedidos;
      const fila = `
        <tr>
          <td>${p.id}</td>
          <td>${p.nombre}</td>
          <td>${p.apellido || ""}</td>
          <td>${item.id}</td>
          <td>${item.producto}</td>
          <td>${item.cantidad}</td>
          <td>$${(item.cantidad * item.precio).toLocaleString()}</td>
        </tr>
      `;
      tabla.innerHTML += fila;
    });
  }

  // 3Ô∏è‚É£ Cargar Productos M√°s Vendidos
  async function cargarProductosMasVendidos() {
    const tabla = document.querySelector("section:nth-of-type(2) table tbody");
    tabla.innerHTML = "<tr><td colspan='5'>Cargando productos...</td></tr>";

    const { data: detalle, error } = await supabase
      .from("detalle_pedido")
      .select("producto, cantidad, precio");

    if (error) {
      console.error("Error al cargar productos:", error);
      tabla.innerHTML = "<tr><td colspan='5'>Error al cargar datos.</td></tr>";
      return;
    }

    if (!detalle || detalle.length === 0) {
      tabla.innerHTML = "<tr><td colspan='5'>No hay productos vendidos.</td></tr>";
      return;
    }

    const productos = {};
    detalle.forEach(item => {
      if (!productos[item.producto]) {
        productos[item.producto] = { cantidad: 0, total: 0, precio: item.precio };
      }
      productos[item.producto].cantidad += item.cantidad;
      productos[item.producto].total += item.cantidad * item.precio;
    });

    const lista = Object.keys(productos).map(nombre => ({
      nombre,
      cantidad: productos[nombre].cantidad,
      precio: productos[nombre].precio,
      total: productos[nombre].total
    })).sort((a, b) => b.cantidad - a.cantidad);

    tabla.innerHTML = "";
    lista.forEach(p => {
      const fila = `
        <tr>
          <td>${p.nombre}</td>
          <td>$${p.precio.toLocaleString()}</td>
          <td>${p.cantidad}</td>
          <td>$${p.total.toLocaleString()}</td>
        </tr>
      `;
      tabla.innerHTML += fila;
    });
  }

  // 4Ô∏è‚É£ Cargar Perfiles de Clientes con foto_url
  async function cargarClientes() {
    const contenedor = document.querySelector(".cliente-cards");
    contenedor.innerHTML = "<p>Cargando clientes...</p>";

    const { data: pedidos, error } = await supabase
      .from("pedidos")
      .select("id, nombre, apellido, telefono, correo, foto_url");

    if (error) {
      console.error("Error al cargar clientes:", error);
      contenedor.innerHTML = "<p>Error al cargar datos.</p>";
      return;
    }

    if (!pedidos || pedidos.length === 0) {
      contenedor.innerHTML = "<p>No hay clientes a√∫n.</p>";
      return;
    }

    contenedor.innerHTML = "";
    pedidos.forEach(c => {
      const foto = c.foto_url
        ? `${SUPABASE_URL}/storage/v1/object/public/perfiles/${c.foto_url}`
        : `https://ui-avatars.com/api/?name=${encodeURIComponent(c.nombre + " " + (c.apellido || ""))}&background=random`;

      const card = `
        <div class="card-cliente">
          <img src="${foto}" alt="Foto de ${c.nombre}" class="cliente-foto" />
          <div class="cliente-info">
            <h3>${c.nombre} ${c.apellido || ""}</h3>
            <p><strong>ID:</strong> ${c.id}</p>
            <p><strong>Tel√©fono:</strong> ${c.telefono || "No registrado"}</p>
            <p><strong>Email:</strong> ${c.correo || "No registrado"}</p>
          </div>
        </div>
      `;
      contenedor.innerHTML += card;
    });
  }
</script>


</body>
</html>
